<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Worship App</title>
<style>
  .segment-button {
    position: relative;
    overflow: hidden;
  }
  .progress-bar {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 3px;
    background-color: #4caf50;
    transition: left 0.05s ease-out;
  }
  #bookmarkBtn {
    font-size: 1.3rem;
    border: none;
    background: none;
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- Install Prompt -->
<div id="installPrompt" style="display:none;">
  <button id="installBtn">📥 Install App</button>
</div>

<!-- Song Selection + Bookmark -->
<div style="margin-bottom: 10px;">
  <label for="songSelect">Select Song:</label>
  <select id="songSelect"></select>
</div>

<!-- Bookmark Star + Dropdown -->
<div style="display: inline-flex; align-items: center; gap: 5px; margin-bottom: 10px;">
  <button id="bookmarkBtn">☆</button>
  <select id="bookmarkDropdown">
    <option value="">🎯 Bookmarked Songs</option>
  </select>
</div>

<!-- Playback Controls -->
<div style="margin-bottom: 10px;">
  <button id="playBtn">▶️ Play</button>
  <button id="pauseBtn">⏸️ Pause</button>
</div>

<!-- Volume Controls -->
<div class="volume-control">
  <label for="vocalVolume">🎤 Vocal Volume:</label>
  <input type="range" id="vocalVolume" min="0" max="1" step="0.01" value="1" />
</div>

<div class="volume-control">
  <label for="accompVolume">🏛️ Accompaniment Volume:</label>
  <input type="range" id="accompVolume" min="0" max="1" step="0.01" value="1" />
</div>

<!-- Lyrics Area -->
<textarea id="lyricsArea" readonly style="width: 90%; height: 300px; margin-top: 20px;"></textarea>

<!-- Scripts -->
<script src="WorshipApp_Modular/tokenLoader.js"></script>
<script src="WorshipApp_Modular/songLoader.js"></script>
<script src="WorshipApp_Modular/audioControl.js"></script>
<script src="WorshipApp_Modular/lyricsHandler.js"></script>
<script src="WorshipApp_Modular/bookmarkHandler.js"></script>
<script src="WorshipApp_Modular/installPrompt.js"></script>

<!-- Bookmark Logic -->
<script>
  const bookmarkBtn = document.getElementById('bookmarkBtn');
  const bookmarkDropdown = document.getElementById('bookmarkDropdown');
  const songSelect = document.getElementById('songSelect');

  let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');

  function updateStar() {
    const currentSong = songSelect.value;
    const isBookmarked = bookmarks.includes(currentSong);
    bookmarkBtn.textContent = isBookmarked ? '★' : '☆';
    bookmarkBtn.style.color = isBookmarked ? 'gold' : '';
  }

  function updateBookmarkDropdown() {
    bookmarkDropdown.innerHTML = '<option value="">🎯 Bookmarked Songs</option>';
    bookmarks.forEach(song => {
      const opt = document.createElement('option');
      opt.value = song;
      opt.textContent = song;
      bookmarkDropdown.appendChild(opt);
    });
  }

  bookmarkBtn.addEventListener('click', () => {
    const currentSong = songSelect.value;
    if (!currentSong) return;
    const idx = bookmarks.indexOf(currentSong);
    if (idx === -1) bookmarks.push(currentSong);
    else bookmarks.splice(idx, 1);
    localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
    updateStar();
    updateBookmarkDropdown();
  });

  songSelect.addEventListener('change', updateStar);

  bookmarkDropdown.addEventListener('change', () => {
    if (bookmarkDropdown.value) {
      songSelect.value = bookmarkDropdown.value;
      songSelect.dispatchEvent(new Event('change'));
    }
  });

  // Initialize
  updateBookmarkDropdown();
  updateStar();
</script>

</body>
</html>
